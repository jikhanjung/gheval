# P03: 여름 위성영상 보기 (Esri Wayback)

## Context

현재 Esri World Imagery는 촬영일 선택이 불가하다. 가을에 촬영된 영상은 식생이 빽빽해도 갈색으로 보여서 토지피복 분석 시 bare rock/soil로 오분류될 수 있다. Esri Wayback Archive를 이용하여 가장 최근 여름(6~8월) 영상을 자동으로 보여주는 기능을 추가한다.

## Esri Wayback Archive

- URL: `https://s3-us-west-2.amazonaws.com/config.maptiles.arcgis.com/waybackconfig.json`
- 377개 버전 (2014~2026), API 키 불필요
- 타일 URL: `https://wayback.maptiles.arcgis.com/.../tile/{releaseNum}/{z}/{y}/{x}`
- 해상도: 현재 Esri 영상과 동일

## 접근 방식

MAP_TYPES에 `"SKYVIEW (Summer)"` 추가. 선택 시 Wayback config JSON에서 최신 여름(6~8월) 버전을 자동으로 찾아 표시. 별도 버전 선택 UI 없이 자동 결정.

## 변경 파일

| 파일 | 변경 내용 |
|------|-----------|
| `GhCommons.py` | `WAYBACK_CONFIG_URL`, `fetch_wayback_summer_version()`, MAP_TYPES 확장 |
| `GhMapBridge.py` | `set_wayback_version` signal 추가 |
| `templates/map_view.html` | wayback 타일 레이어, `setWaybackVersion()` JS 함수 |
| `GhComponents.py` | `WaybackLoader` QThread, MapWidget 메서드 |
| `GhEval.py` | UI 연결, 상태바 메시지 |

## 구현 단계

### 1. GhCommons.py

- `WAYBACK_CONFIG_URL` 상수
- `fetch_wayback_summer_version(force_refresh)`: config JSON 다운로드/캐시(24h TTL), 6~8월 중 최신 `(release_num, date_str)` 반환
- `MAP_TYPES`에 `"SKYVIEW (Summer)"` 추가

### 2. GhMapBridge.py

- `set_wayback_version = pyqtSignal(int)` signal
- `set_wayback(release_num)` 편의 메서드

### 3. templates/map_view.html

- `waybackLayer` 변수 선언
- `setWaybackVersion(releaseNum)` 함수: 타일 레이어 생성/교체
- `changeMapType()`에 `"SKYVIEW_SUMMER"` 분기 추가
- QWebChannel에 signal 연결

### 4. GhComponents.py

- `WaybackLoader(QThread)`: 백그라운드에서 config fetch
- `MapWidget.set_wayback_version(release_num)` 메서드

### 5. GhEval.py

- `_on_map_type_combo_changed()`에서 "SKYVIEW (Summer)" 처리
- `_load_summer_wayback()`: WaybackLoader 실행
- `_on_wayback_loaded()`: 결과 적용, 상태바 표시

## Verification

1. 앱 실행 -> 맵 타입 콤보에 "SKYVIEW (Summer)" 확인
2. 선택 시 상태바 "Loading summer imagery..." -> "Summer imagery: YYYY-MM-DD"
3. 여름 영상 타일 정상 로드 확인
4. 다른 맵 타입 전환 후 복귀 시 정상 동작
