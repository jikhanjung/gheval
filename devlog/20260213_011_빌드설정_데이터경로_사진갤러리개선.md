# 011: PyInstaller 빌드 설정, 데이터 경로 변경, 사진 갤러리 개선

**날짜**: 2026-02-13

## 변경 요약

1. PyInstaller 빌드 환경 구성 (onefile/onedir 지원)
2. 데이터 저장 경로를 실행파일 옆 `data/` 폴더로 변경
3. 초기 맵 레이어를 SKYVIEW (Summer)로 설정
4. Photos 탭 갤러리 UI 전면 개선 (FlowLayout, 고정 썸네일, 더블클릭 뷰어)
5. Inno Setup 설치 스크립트 추가

## 변경 내용

### 빌드 설정

- `gheval.spec`: `collect_all('PyQt6')` 로 모든 DLL 수집, 환경변수 `GHEVAL_ONEDIR`로 모드 전환
- `build.py`: `python build.py` (onefile) / `python build.py --onedir` (onedir), 진행 메시지 실시간 출력, 소요시간/파일크기 리포트
- `build.bat`: Windows 배치 스크립트
- `gheval_setup.iss`: Inno Setup 스크립트 (onedir 빌드 → 설치 프로그램)
- `requirements.txt`: `pyinstaller>=6.0` 추가

### GhCommons.py — 데이터 경로 변경

```python
# 변경 전: ~/.gheval/ (또는 %APPDATA%/.gheval/)
# 변경 후: 실행파일 옆 data/ 폴더
def get_data_dir():
    if getattr(sys, 'frozen', False):
        base = os.path.dirname(sys.executable)
    else:
        base = os.path.dirname(os.path.abspath(__file__))
    return os.path.join(base, "data")
```

### GhEval.py — 초기 맵 레이어

`_on_map_ready()`에서 `map_type_combo.setCurrentText("SKYVIEW (Summer)")` 호출.

### GhComponents.py — 사진 갤러리 개선

**`_FlowLayout`**: 커스텀 QLayout. 위젯을 왼쪽부터 채우고 폭 초과 시 줄바꿈. `heightForWidth()` 구현으로 QScrollArea와 호환.

**`_ThumbnailWidget`**: 고정 크기(130×100) 썸네일 위젯.
- 이미지 + 라벨 표시
- 더블클릭 → `QDialog`로 원본 이미지 뷰어 (화면 85% 이내)
- 포인터 커서 표시

**`PhotoGalleryWidget` 변경:**

| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| 레이아웃 | QGridLayout (균등 분배) | _FlowLayout (왼쪽 정렬) |
| 썸네일 | QWidget 임시 조합 | _ThumbnailWidget 고정 크기 |
| 빈 공간 | addStretch()로 1/3 공백 | stretch=1 균등 배분, 공백 없음 |
| 더블클릭 | 없음 | 원본 이미지 QDialog 뷰어 |

### .gitignore

`data/`, `installer/` 추가. `gheval.spec` 추적 허용.

## 수정/추가 파일

| 파일 | 변경 |
|------|------|
| `GhCommons.py` | `get_data_dir()` 경로 변경 |
| `GhComponents.py` | `_FlowLayout`, `_ThumbnailWidget`, `PhotoGalleryWidget` 개선 |
| `GhEval.py` | 초기 맵 레이어 SKYVIEW (Summer) |
| `requirements.txt` | pyinstaller 추가 |
| `.gitignore` | data/, installer/ 추가, gheval.spec 허용 |
| `gheval.spec` | 신규 — PyInstaller spec (onefile/onedir) |
| `build.py` | 신규 — 빌드 스크립트 |
| `build.bat` | 신규 — Windows 배치 스크립트 |
| `gheval_setup.iss` | 신규 — Inno Setup 설치 스크립트 |
