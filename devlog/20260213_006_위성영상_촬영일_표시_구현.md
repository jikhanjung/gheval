# 006: 위성영상 촬영일 표시 + 촬영일 기반 여름 영상 검색

**날짜**: 2026-02-13
**계획**: P04

## 변경 요약

1. 모든 satellite 모드에서 현재 보고 있는 영상의 실제 촬영일과 제공자를 맵 좌하단에 오버레이 표시
2. SKYVIEW (Summer) 선택 시 릴리스 날짜가 아닌 **실제 촬영일(SRC_DATE2)** 기준으로 여름(6-8월) 영상을 검색

## 변경 내용

### GhCommons.py
- `_load_wayback_config()`: config 로딩/캐싱 분리
- `fetch_wayback_summer_by_capture(lat, lng)`: **핵심** — 각 Wayback 버전의 metadata 서비스를 조회하여 해당 위치의 SRC_DATE2가 6-8월인 버전을 찾음 (최대 30개 버전 시도, 같은 촬영일 중복 스킵, fallback으로 릴리스 날짜 기반 검색)
- `_find_summer_by_release_date()`: 기존 릴리스 날짜 기반 검색 (fallback용)
- `fetch_wayback_summer_version()`: 기존 API 유지 (fallback)

### GhMapBridge.py
- `set_wayback_version` signal: `pyqtSignal(int)` → `pyqtSignal(str)` (JSON)
- `set_wayback()`: `release_num, date_str, metadata_url` 파라미터, JSON 직렬화

### GhComponents.py
- `MapWidget.set_wayback_version()`: 3개 파라미터로 확장
- `WaybackLoader`: lat/lng 받아 `fetch_wayback_summer_by_capture()` 호출, progress signal 추가

### GhEval.py
- `_load_summer_wayback()`: 현재 사이트 좌표 또는 기본 좌표를 WaybackLoader에 전달, progress 연결
- `_on_wayback_loaded()`: 3-tuple 언패킹

### templates/map_view.html
- CSS: `.imagery-info` 스타일 (반투명 검은 배경, 흰색 monospace 텍스트)
- `imageryInfo` Leaflet Control (bottomleft)
- `moveend` 이벤트 핸들러 (500ms 디바운스)
- `fetchCurrentDate()`: Esri World Imagery Layer 4 query
- `fetchWaybackDate()`: Wayback metadataLayerUrl query (줌별 layer 선택)
- `showImageryDate()`: 줌 레벨 필터 적용, 촬영일/제공자 포맷
- `showWaybackFallback()`: 메타데이터 조회 실패 시 release date만 표시
- `setWaybackVersion()`: JSON 파싱으로 변경, `_waybackMeta` 저장
- `changeMapType()`: ROADMAP 전환 시 오버레이 숨김, satellite 모드 전환 시 날짜 조회 트리거

## 표시 형식
- SKYVIEW/HYBRID: `Captured: 2023-05-15 | Maxar`
- SKYVIEW_SUMMER: `Wayback 2024-07-10 | Captured: 2023-06-20 | Maxar`
- ROADMAP: 오버레이 숨김

## 검색 로직 (`fetch_wayback_summer_by_capture`)

최신순으로 정렬된 Wayback 버전을 최대 30개까지 조회하며, 중복 촬영일은 스킵:

| 우선순위 | 조건 | 동작 |
|---------|------|------|
| 1 | SRC_DATE2가 6-8월 & 5년 이내 | 즉시 반환 |
| 2 | 5년 이내 촬영일 중 7/1에 가장 가까운 날짜 | 루프 종료 후 반환 |
| 3 | 5년 이내 결과 없음 | 최신 Wayback 버전 반환 |
